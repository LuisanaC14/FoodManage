<div class="sidebar-wrapper" style="background: #111; border: 1px solid #333; padding: 25px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.5);">
    
    <div class="sidebar-widget mb-4">
        <div class="input-group">
            <input type="text" id="searchInput" class="form-control" placeholder="Buscar plato..." onkeyup="aplicarFiltros()"
                   style="background: #000; border: 1px solid #444; color: #fff; border-radius: 8px 0 0 8px;">
            <button class="btn" type="button" onclick="aplicarFiltros()" 
                    style="background: #ccff00; color: #000; font-weight: bold; border-radius: 0 8px 8px 0;">
                <i class="fas fa-search"></i>
            </button>
        </div>
    </div>

    <div class="sidebar-widget mb-4">
        <h5 class="widget-title" style="color: #fff; font-weight: 800; text-transform: uppercase; font-size: 1.1rem; border-left: 4px solid #ccff00; padding-left: 10px; margin-bottom: 20px;">
            Nuestro Menú
        </h5>
        <ul class="list-unstyled">
            <li class="mb-2">
                <a href="javascript:void(0)" onclick="seleccionarCategoria('todos', this)" class="cat-link active d-flex justify-content-between align-items-center text-decoration-none py-2" style="border-bottom: 1px solid #222; color: #aaa; transition: 0.3s;">
                    <span><i class="fas fa-utensils me-2"></i>Todo</span>
                    <span class="badge bg-dark text-white rounded-pill">{{ conteos.total }}</span>
                </a>
            </li>

            <li class="mb-2">
                <a href="javascript:void(0)" onclick="seleccionarCategoria('arroz', this)" class="cat-link d-flex justify-content-between align-items-center text-decoration-none py-2" style="border-bottom: 1px solid #222; color: #aaa; transition: 0.3s;">
                    <span><i class="fas fa-bowl-rice me-2"></i>Arroces</span>
                    <span class="badge bg-dark text-white rounded-pill">{{ conteos.arroz }}</span>
                </a>
            </li>

            <li class="mb-2">
                <a href="javascript:void(0)" onclick="seleccionarCategoria('sopa', this)" class="cat-link d-flex justify-content-between align-items-center text-decoration-none py-2" style="border-bottom: 1px solid #222; color: #aaa; transition: 0.3s;">
                    <span><i class="fas fa-bowl-food me-2"></i>Sopas</span>
                    <span class="badge bg-dark text-white rounded-pill">{{ conteos.sopa }}</span>
                </a>
            </li>

            <li class="mb-2">
                <a href="javascript:void(0)" onclick="seleccionarCategoria('porcion', this)" class="cat-link d-flex justify-content-between align-items-center text-decoration-none py-2" style="border-bottom: 1px solid #222; color: #aaa; transition: 0.3s;">
                    <span><i class="fas fa-drumstick-bite me-2"></i>Porciones</span>
                    <span class="badge bg-dark text-white rounded-pill">{{ conteos.porcion }}</span>
                </a>
            </li>

            <li class="mb-2">
                <a href="javascript:void(0)" onclick="seleccionarCategoria('bebida', this)" class="cat-link d-flex justify-content-between align-items-center text-decoration-none py-2" style="border-bottom: 1px solid #222; color: #aaa; transition: 0.3s;">
                    <span><i class="fas fa-cocktail me-2"></i>Bebidas</span>
                    <span class="badge bg-dark text-white rounded-pill">{{ conteos.bebida }}</span>
                </a>
            </li>

            <li class="mb-2">
                <a href="javascript:void(0)" onclick="seleccionarCategoria('extra', this)" class="cat-link d-flex justify-content-between align-items-center text-decoration-none py-2" style="border-bottom: 1px solid #222; color: #aaa; transition: 0.3s;">
                    <span><i class="fas fa-plus-circle me-2"></i>Extras</span>
                    <span class="badge bg-dark text-white rounded-pill">{{ conteos.extra }}</span>
                </a>
            </li>
        </ul>
    </div>

    <div class="sidebar-widget mb-4">
        <h5 class="widget-title" style="color: #fff; font-weight: 800; text-transform: uppercase; font-size: 1.1rem; border-left: 4px solid #ccff00; padding-left: 10px; margin-bottom: 20px;">
            Rango de Precio
        </h5>
        <div class="mt-3">
            <input type="range" class="form-range" min="1" max="50" step="1" id="priceRange" 
                   oninput="aplicarFiltros()" 
                   style="accent-color: #ccff00;">
            
            <div class="d-flex justify-content-between align-items-center mt-2">
                <span class="text-white small">Max: $<span id="priceValue" style="color: #ccff00; font-weight: bold;">25</span></span>
                <button class="btn btn-sm" onclick="aplicarFiltros()" style="border: 1px solid #ccff00; color: #ccff00; border-radius: 20px; font-size: 0.7rem;">FILTRAR</button>
            </div>
        </div>
    </div>
</div>

<style>
    .cat-link:hover, .cat-link.active { color: #ccff00 !important; padding-left: 10px; font-weight: bold; }
    .cat-link:hover .badge, .cat-link.active .badge { background: #ccff00 !important; color: #000 !important; }
    .menu-item { transition: all 0.3s ease; }
</style>

<script>
    // VARIABLE GLOBAL PARA GUARDAR LA CATEGORÍA SELECCIONADA
    let categoriaActual = 'todos';

    function seleccionarCategoria(categoria, elemento) {
        // 1. Efecto visual (Poner en amarillo el link)
        document.querySelectorAll('.cat-link').forEach(link => link.classList.remove('active'));
        if(elemento) elemento.classList.add('active');

        // 2. Guardamos la categoría en la memoria
        categoriaActual = categoria;

        // 3. Llamamos al filtro maestro para que recalcule todo
        aplicarFiltros();
    }

    // --- ESTA ES LA FUNCIÓN MAESTRA (BUSCADOR + PRECIO + CATEGORÍA) ---
    function aplicarFiltros() {
        // A. OBTENEMOS LOS DATOS DE LOS 3 FILTROS
        
        // 1. TEXTO DEL BUSCADOR (Aquí está lo que te preocupaba, ¡sigue aquí!)
        const textoBusqueda = document.getElementById('searchInput').value.toLowerCase();
        
        // 2. PRECIO DEL SLIDER
        const precioMaximo = parseFloat(document.getElementById('priceRange').value);
        
        // Actualizamos el numerito del precio visualmente
        document.getElementById('priceValue').innerText = precioMaximo;

        // B. REVISAMOS CADA PLATO UNO POR UNO
        const platos = document.querySelectorAll('.menu-item');

        platos.forEach(plato => {
            // Obtenemos los datos ocultos del HTML del plato
            const catPlato = plato.getAttribute('data-category'); 
            const precioPlato = parseFloat(plato.getAttribute('data-price') || 0);
            
            // Obtenemos el nombre del plato para buscar
            const nombrePlato = plato.querySelector('h5') ? plato.querySelector('h5').innerText.toLowerCase() : "";

            // --- AQUÍ ESTÁ LA MAGIA: COMPROBAMOS LAS 3 COSAS A LA VEZ ---
            
            // Condición 1: ¿Coincide la categoría? (Si es 'todos' siempre es sí)
            const coincideCategoria = (categoriaActual === 'todos') || (catPlato === categoriaActual);
            
            // Condición 2: ¿El precio es menor al slider?
            const coincidePrecio = (precioPlato <= precioMaximo);
            
            // Condición 3: ¿El nombre tiene el texto que escribiste? (ESTO ES EL BUSCADOR)
            const coincideTexto = nombrePlato.includes(textoBusqueda);

            // SI CUMPLE LAS 3, SE MUESTRA. SI FALLA ALGUNA, SE OCULTA.
            if (coincideCategoria && coincidePrecio && coincideTexto) {
                plato.style.display = 'block';
                plato.classList.add('animate__fadeIn');
            } else {
                plato.style.display = 'none';
            }
        });
    }

    // Inicializar al cargar para que el slider arranque al máximo
    document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('priceRange').value = 50; 
        document.getElementById('priceValue').innerText = "50";
    });
</script>